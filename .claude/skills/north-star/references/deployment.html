<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deployment Guides - North Star Architecture</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            font-size: 2em;
            margin-top: 40px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 8px;
        }
        h3 {
            color: #2c3e50;
            font-size: 1.5em;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        h4 {
            color: #34495e;
            font-size: 1.2em;
            margin-top: 15px;
            margin-bottom: 10px;
        }
        p {
            margin-bottom: 15px;
        }
        ul, ol {
            margin-left: 30px;
            margin-bottom: 15px;
        }
        li {
            margin-bottom: 8px;
        }
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin-bottom: 20px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }
        code {
            background: #ecf0f1;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }
        pre code {
            background: transparent;
            padding: 0;
        }
        strong {
            color: #2c3e50;
            font-weight: 600;
        }
        .nav {
            background: #34495e;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 30px;
        }
        .nav a {
            color: #3498db;
            text-decoration: none;
            margin-right: 15px;
            font-weight: 500;
        }
        .nav a:hover {
            text-decoration: underline;
        }
        .pattern-box {
            background: #fff9e6;
            border-left: 4px solid #f39c12;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .requirement {
            background: #e8f8f5;
            border-left: 4px solid #27ae60;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .workflow {
            background: #fef5e7;
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .checklist {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .checklist li {
            list-style: none;
            padding-left: 30px;
            position: relative;
        }
        .checklist li:before {
            content: '☐';
            position: absolute;
            left: 0;
            font-size: 1.2em;
            color: #3498db;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav">
            <a href="../SKILL.html">Back to Main</a>
        </div>

        <h1>Deployment Guides</h1>

        <p>Comprehensive deployment strategies for on-premises and cloud environments.</p>

        <h2>Table of Contents</h2>
        <ol>
            <li>On-Premises Deployment</li>
            <li>Cloud Deployment</li>
            <li>Hybrid Deployment</li>
            <li>Configuration Management</li>
            <li>Security Best Practices</li>
        </ol>

        <h2>1. On-Premises Deployment</h2>

        <h3>Docker Compose (Recommended for MVP)</h3>

        <div class="pattern-box">
            <h4>When to use</h4>
            <p>Single-node MVP, quick deployment</p>
        </div>

        <h4>Project Structure</h4>

        <pre>mvp-project/
├── docker-compose.yml
├── .env
├── services/
│   ├── api/
│   │   ├── Dockerfile
│   │   ├── requirements.txt
│   │   └── app/
│   ├── rag/
│   │   ├── Dockerfile
│   │   └── ...
│   └── genai/
│       ├── Dockerfile
│       └── ...
└── data/
    └── vector_db/</pre>

        <h4>docker-compose.yml Template</h4>

        <pre>version: '3.8'

services:
  # Vector Database (ChromaDB)
  vector-db:
    image: chromadb/chroma:latest
    ports:
      - "8000:8000"
    volumes:
      - ./data/vector_db:/chroma/chroma
    environment:
      - IS_PERSISTENT=TRUE

  # LLM Inference (Ollama)
  llm:
    image: ollama/ollama:latest
    ports:
      - "11434:11434"
    volumes:
      - ./data/ollama:/root/.ollama
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]  # If GPU available

  # API Service
  api:
    build: ./services/api
    ports:
      - "8080:8080"
    environment:
      - VECTOR_DB_URL=http://vector-db:8000
      - LLM_URL=http://llm:11434
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
    env_file:
      - .env
    depends_on:
      - vector-db
      - llm
    volumes:
      - ./services/api/app:/app
    restart: unless-stopped

  # RAG Ingestion Service
  rag-ingestion:
    build: ./services/rag
    environment:
      - VECTOR_DB_URL=http://vector-db:8000
      - DATA_SOURCE_PATH=/data/documents
    volumes:
      - ./data/documents:/data/documents
    depends_on:
      - vector-db</pre>

        <h4>.env Template</h4>

        <pre>
# Application
APP_NAME=north-star-mvp
LOG_LEVEL=INFO

# LLM Configuration
LLM_MODEL=llama3
LLM_TEMPERATURE=0.7

# RAG Configuration
EMBEDDING_MODEL=all-MiniLM-L6-v2
CHUNK_SIZE=512
CHUNK_OVERLAP=50
TOP_K=5

# API Security
API_KEY=your-secure-api-key-here
CORS_ORIGINS=http://localhost:3000,http://localhost:8080

# Database
VECTOR_DB_COLLECTION=documents</pre>

        <h4>Deployment Steps</h4>

        <pre># 1. Clone/copy project to on-prem server
scp -r mvp-project/ user@server:/opt/

# 2. SSH into server
ssh user@server

# 3. Navigate to project
cd /opt/mvp-project

# 4. Configure environment
cp .env.example .env
nano .env  # Edit as needed

# 5. Pull Ollama model
docker compose run llm ollama pull llama3

# 6. Start services
docker compose up -d

# 7. Verify
docker compose ps
curl http://localhost:8080/health</pre>

        <h3>Kubernetes (For Production Scale)</h3>

        <div class="pattern-box">
            <h4>When to use</h4>
            <p>Multi-node clusters, high availability</p>
        </div>

        <h4>Deployment YAML Example</h4>

        <pre>apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: api
  template:
    metadata:
      labels:
        app: api
    spec:
      containers:
      - name: api
        image: your-registry/api:latest
        ports:
        - containerPort: 8080
        env:
        - name: VECTOR_DB_URL
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: vector_db_url
        - name: LLM_URL
          valueFrom:
            configMapKeyRef:
              name: app-config
              key: llm_url
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi"
            cpu: "1000m"
---
apiVersion: v1
kind: Service
metadata:
  name: api-service
spec:
  selector:
    app: api
  ports:
  - port: 80
    targetPort: 8080
  type: LoadBalancer</pre>

        <h4>Deployment Steps</h4>

        <pre># 1. Build and push images
docker build -t your-registry/api:latest ./services/api
docker push your-registry/api:latest

# 2. Apply configurations
kubectl apply -f k8s/configmap.yaml
kubectl apply -f k8s/secrets.yaml

# 3. Deploy services
kubectl apply -f k8s/vector-db.yaml
kubectl apply -f k8s/llm.yaml
kubectl apply -f k8s/api.yaml

# 4. Verify
kubectl get pods
kubectl get services</pre>

        <h2>2. Cloud Deployment</h2>

        <h3>Cloud-Agnostic Approach (Recommended)</h3>

        <p>Use Docker + cloud VMs for portability across AWS, GCP, Azure.</p>

        <h4>Generic Cloud Deployment</h4>

        <pre># 1. Provision VM (example with any cloud provider)
# - OS: Ubuntu 22.04 LTS
# - RAM: 8GB+ (16GB recommended)
# - Storage: 50GB+
# - GPU: Optional (for faster inference)

# 2. Install Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER

# 3. Install Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# 4. Clone project
git clone &lt;your-repo&gt;
cd mvp-project

# 5. Deploy
docker-compose up -d</pre>

        <h3>AWS-Specific</h3>

        <h4>Option 1: EC2 + Docker Compose</h4>

        <pre># Launch EC2 instance
aws ec2 run-instances \
  --image-id ami-0c55b159cbfafe1f0 \
  --instance-type t3.xlarge \
  --key-name your-key \
  --security-group-ids sg-xxxxx \
  --subnet-id subnet-xxxxx

# Follow generic cloud deployment steps above</pre>

        <h4>Option 2: ECS (Elastic Container Service)</h4>

        <pre>{
  "family": "north-star-mvp",
  "containerDefinitions": [
    {
      "name": "api",
      "image": "your-ecr-repo/api:latest",
      "memory": 1024,
      "cpu": 512,
      "portMappings": [
        {
          "containerPort": 8080,
          "protocol": "tcp"
        }
      ],
      "environment": [
        {
          "name": "VECTOR_DB_URL",
          "value": "http://vector-db:8000"
        }
      ]
    }
  ]
}</pre>

        <h3>GCP-Specific</h3>

        <h4>Option 1: Compute Engine + Docker Compose</h4>

        <pre># Create instance
gcloud compute instances create north-star-mvp \
  --machine-type=n1-standard-4 \
  --image-family=ubuntu-2204-lts \
  --image-project=ubuntu-os-cloud \
  --boot-disk-size=50GB

# SSH and deploy
gcloud compute ssh north-star-mvp
# Follow generic cloud deployment steps</pre>

        <h4>Option 2: GKE (Google Kubernetes Engine)</h4>

        <pre># Create cluster
gcloud container clusters create north-star-cluster \
  --num-nodes=3 \
  --machine-type=n1-standard-4

# Deploy with kubectl (see Kubernetes section above)</pre>

        <h3>Azure-Specific</h3>

        <h4>Option 1: VM + Docker Compose</h4>

        <pre># Create VM
az vm create \
  --resource-group north-star-rg \
  --name north-star-vm \
  --image UbuntuLTS \
  --size Standard_D4s_v3 \
  --admin-username azureuser

# Follow generic cloud deployment steps</pre>

        <h4>Option 2: AKS (Azure Kubernetes Service)</h4>

        <pre># Create cluster
az aks create \
  --resource-group north-star-rg \
  --name north-star-aks \
  --node-count 3 \
  --node-vm-size Standard_D4s_v3

# Deploy with kubectl</pre>

        <h2>3. Hybrid Deployment</h2>

        <h3>Pattern: Data On-Prem, Compute in Cloud</h3>

        <div class="pattern-box">
            <h4>When to use</h4>
            <p>Data residency requirements, cloud compute benefits</p>
        </div>

        <pre>┌─────────────────┐         ┌─────────────────┐
│   On-Premises   │         │      Cloud      │
│                 │         │                 │
│  Document Store │◄───────►│   API Service   │
│  File Store     │  VPN/   │   GenAI/RAG     │
│  Vector DB      │  Direct │   LLM Inference │
└─────────────────┘  Link   └─────────────────┘</pre>

        <p><strong>Setup</strong>:</p>
        <ol>
            <li>Deploy vector DB and data stores on-prem</li>
            <li>Deploy compute-intensive services (LLM, API) in cloud</li>
            <li>Connect via VPN or direct link with encryption</li>
            <li>Use API authentication for security</li>
        </ol>

        <h3>Pattern: Multi-Region Deployment</h3>

        <div class="pattern-box">
            <h4>When to use</h4>
            <p>Global users, data locality laws</p>
        </div>

        <pre>┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│  Region US   │    │  Region EU   │    │  Region APAC │
│              │    │              │    │              │
│  Full Stack  │    │  Full Stack  │    │  Full Stack  │
│  Local Data  │    │  Local Data  │    │  Local Data  │
└──────────────┘    └──────────────┘    └──────────────┘</pre>

        <h2>4. Configuration Management</h2>

        <h3>Environment-Specific Configs</h3>

        <pre>config/
├── base.yaml           # Common settings
├── dev.yaml           # Development overrides
├── staging.yaml       # Staging overrides
└── production.yaml    # Production overrides</pre>

        <h3>Secrets Management</h3>

        <h4>On-Prem: Docker secrets or HashiCorp Vault</h4>

        <pre>services:
  api:
    secrets:
      - api_key
      - db_password

secrets:
  api_key:
    file: ./secrets/api_key.txt
  db_password:
    file: ./secrets/db_password.txt</pre>

        <h4>Cloud: Use cloud-native secrets</h4>

        <ul>
            <li><strong>AWS</strong>: AWS Secrets Manager</li>
            <li><strong>GCP</strong>: Secret Manager</li>
            <li><strong>Azure</strong>: Key Vault</li>
        </ul>

        <h3>Configuration Loading Pattern</h3>

        <pre>import os
import yaml

def load_config():
    env = os.getenv('ENVIRONMENT', 'dev')

    # Load base config
    with open('config/base.yaml') as f:
        config = yaml.safe_load(f)

    # Load environment-specific config
    with open(f'config/{env}.yaml') as f:
        env_config = yaml.safe_load(f)

    # Merge configs
    config.update(env_config)

    # Override with environment variables
    config['llm_url'] = os.getenv('LLM_URL', config['llm_url'])

    return config</pre>

        <h2>5. Security Best Practices</h2>

        <h3>Network Security</h3>

        <pre>networks:
  frontend:
    driver: bridge
  backend:
    driver: bridge
    internal: true  # No external access

services:
  api:
    networks:
      - frontend
      - backend

  vector-db:
    networks:
      - backend  # Not exposed externally</pre>

        <h3>API Security</h3>

        <pre>from fastapi import Security, HTTPException
from fastapi.security import APIKeyHeader

api_key_header = APIKeyHeader(name="X-API-Key")

def verify_api_key(api_key: str = Security(api_key_header)):
    if api_key != os.getenv("API_KEY"):
        raise HTTPException(status_code=403, detail="Invalid API Key")
    return api_key</pre>

        <h3>TLS/HTTPS</h3>

        <pre>server {
    listen 443 ssl;
    server_name your-domain.com;

    ssl_certificate /etc/ssl/certs/cert.pem;
    ssl_certificate_key /etc/ssl/private/key.pem;

    location / {
        proxy_pass http://api:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}</pre>

        <h3>Resource Limits</h3>

        <pre>services:
  api:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '1'
          memory: 1G</pre>

        <h2>Health Checks</h2>

        <h3>Application Health Endpoint</h3>

        <pre>@app.get("/health")
async def health():
    checks = {
        "api": "healthy",
        "vector_db": await check_vector_db(),
        "llm": await check_llm()
    }

    all_healthy = all(v == "healthy" for v in checks.values())

    return {
        "status": "healthy" if all_healthy else "degraded",
        "checks": checks
    }</pre>

        <h3>Docker Compose Health Checks</h3>

        <pre>services:
  api:
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s</pre>

        <h2>Monitoring</h2>

        <h3>Prometheus + Grafana</h3>

        <pre>services:
  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin</pre>

        <h3>Application Metrics</h3>

        <pre>from prometheus_client import Counter, Histogram, make_asgi_app

query_counter = Counter('queries_total', 'Total queries')
query_duration = Histogram('query_duration_seconds', 'Query duration')

@app.get("/query")
@query_duration.time()
async def query(q: str):
    query_counter.inc()
    # Process query
    return result

# Mount metrics endpoint
metrics_app = make_asgi_app()
app.mount("/metrics", metrics_app)</pre>

        <h2>Backup and Recovery</h2>

        <h3>Vector DB Backup</h3>

        <pre>#!/bin/bash
BACKUP_DIR=/backups/vector_db
DATE=$(date +%Y%m%d_%H%M%S)

# Stop writes (optional, for consistency)
# docker-compose exec vector-db /pause-writes.sh

# Backup
docker-compose exec -T vector-db tar czf - /chroma/chroma > $BACKUP_DIR/backup_$DATE.tar.gz

# Resume writes
# docker-compose exec vector-db /resume-writes.sh

# Cleanup old backups (keep last 7 days)
find $BACKUP_DIR -name "backup_*.tar.gz" -mtime +7 -delete</pre>

        <h3>Automated Backups</h3>

        <pre>services:
  backup:
    image: your-backup-image
    volumes:
      - ./data:/data:ro
      - /backups:/backups
    environment:
      - BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM</pre>

        <h2>Deployment Checklist</h2>

        <div class="checklist">
            <p>Before going live:</p>
            <ul>
                <li>Environment variables configured</li>
                <li>Secrets properly managed (not in code)</li>
                <li>TLS/HTTPS enabled</li>
                <li>API authentication enabled</li>
                <li>Resource limits set</li>
                <li>Health checks configured</li>
                <li>Monitoring and logging set up</li>
                <li>Backup strategy implemented</li>
                <li>Firewall rules configured</li>
                <li>Documentation complete (runbooks, incident response)</li>
                <li>Tested on-prem deployment</li>
                <li>Tested cloud deployment</li>
                <li>Load testing completed</li>
                <li>Security scan completed</li>
            </ul>
        </div>

        <div class="nav">
            <a href="../SKILL.html">Back to Main</a>
        </div>
    </div>
</body>
</html>
